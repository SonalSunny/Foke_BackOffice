@page
@model FOKE.Pages.FileManager.ManageModel
@{
}
<input type="hidden" id="hidSearch" value="" />
<input type="hidden" id="Folderid" value="1" />
<input type="hidden" id="FolderName" value="Documents" />
<input type="hidden" id="hidPageCode" value="FILEMANAGER" />
<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
	<!--begin::Content wrapper-->
	<div class="d-flex flex-column flex-column-fluid">
		<!--begin::Toolbar-->
		<div id="kt_app_content" class="app-content flex-column-fluid">
			<!--begin::Content container-->
			<div id="kt_app_content_container" class="app-container container-xxl">
				<!--begin::Card-->
				<div class="card card-flush">
					<!--begin::Card header-->
					<div class="card-header pt-5">
						<div class="card-title">
							<div class="row">
								<h3 class="fw-bold m-0 mb-5" id="folderTitle">
									<!-- Dynamically set based on folder -->
								</h3>
							</div>
						</div>
						<div class="d-flex align-items-center position-relative gap-2 my-1 pe-md-2 w-100 w-md-400px">
							<input type="text" class="form-control form-control-sm flex-grow-1" placeholder="Search" id="txtSearchInputField" />

							<button type="button" class="btn btn-sm btn-light-primary d-flex align-items-center gap-1 btnSearch" id="btnRefresh">
								<i class="fas fa-search"></i>
								Search
							</button>

							<button type="button" class="btn btn-sm btn-light-primary d-flex align-items-center gap-1 btnReset" id="btnReset">
								<i class="fas fa-sync-alt"></i>
								Reset
							</button>
						</div>
					</div>
					<!--end::Card header-->
					<!--begin::Card body-->
					<div class="card-body">
						<!--begin::Table-->
						<div class="table-responsive">
							<table id="kt_file_manager_list" data-kt-filemanager-table="folders" class="table align-middle table-row-dashed fs-6 gy-5">
								<thead>
									<tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
										<th class="min-w-150px min-w-sm-250px">Name</th>
										<th class="min-w-150px min-w-sm-250px">Date Modified</th>
										<th class="min-w-150px min-w-sm-250px">Type</th>
										<th class="min-w-150px min-w-sm-250px">Size</th>
										<th class="w-125px"></th>
									</tr>
								</thead>
								<tbody class="fw-semibold text-gray-600" id="folderContents">
									<!-- Content will be dynamically populated based on folder -->
								</tbody>
							</table>
						</div>
						<!--end::Table-->
						<div class="col-12 text-end">
							<button id="btnBack" type="button" class="btn btn-secondary btn-flat btn-sm">
								<i class="fas fa-arrow-left"></i> Back
							</button>
						</div>
					</div>
					<!--end::Card body-->
				</div>
				<!--end::Content container-->
			</div>
			<!--end::Content-->
		</div>
		<!--end::Content wrapper-->
		<!--begin::Footer-->
		<nav aria-label="Page navigation">
			<ul class="pagination justify-content-center">
				<li class="page-item disabled">
					<a class="page-link" href="#" aria-label="Previous">
						<span aria-hidden="true">&laquo;</span>
					</a>
				</li>
				<li class="page-item active">
					<a class="page-link" href="#">1</a>
				</li>
				<li class="page-item">
					<a class="page-link" href="#">2</a>
				</li>
				<li class="page-item">
					<a class="page-link" href="#">3</a>
				</li>
				<li class="page-item">
					<a class="page-link" href="#" aria-label="Next">
						<span aria-hidden="true">&raquo;</span>
					</a>
				</li>
			</ul>
		</nav>
		<!--end::Footer-->
	</div>
	<script type="text/javascript">
		$(function () {
			// Get folder ID from URL
			const urlParams = new URLSearchParams(window.location.search);
			const folderId = urlParams.get('id');
			const folderName = urlParams.get('Foldername');

			// Set folder title
			$('#folderTitle').text(folderName || 'Documents');
			$('#Folderid').val(folderId || '1');
			$('#FolderName').val(folderName || 'Documents');

			// Define folder contents
			const folderContents = {
				'1': { // Finance Documents
					title: 'Finance Documents',
					files: [
						{
							name: 'Q1-Report.xlsx',
							date: '2023-05-10',
							type: 'Microsoft Excel Worksheet',
							size: '512 KB',
							icon: 'fa-file-excel text-success',
							url: '/files/Q1-Report.xlsx'
						},
						{
							name: 'Annual-Budget.xlsx',
							date: '2023-04-15',
							type: 'Microsoft Excel Worksheet',
							size: '780 KB',
							icon: 'fa-file-excel text-success',
							url: '/files/Annual-Budget.xlsx'
						}
					]
				},
				'2': { // HR Policies
					title: 'HR Policies',
					files: [
						{
							name: 'Leave-Policy.pdf',
							date: '2023-06-01',
							type: 'PDF Document',
							size: '320 KB',
							icon: 'fa-file-pdf text-danger',
							url: '/files/Leave-Policy.pdf'
						},
						{
							name: 'Employee-Handbook.docx',
							date: '2023-05-20',
							type: 'Microsoft Word Document',
							size: '450 KB',
							icon: 'fa-file-word text-primary',
							url: '/files/Employee-Handbook.docx'
						}
					]
				},
				'3': { // Project Documentation
					title: 'Project Documentation',
					files: [
						{
							name: 'ProjectX-Specs.xlsx',
							date: '2023-06-15',
							type: 'Microsoft Excel Worksheet',
							size: '620 KB',
							icon: 'fa-file-excel text-success',
							url: '/files/ProjectX-Specs.xlsx'
						},
						{
							name: 'Project-Timeline.pptx',
							date: '2023-06-10',
							type: 'Microsoft PowerPoint',
							size: '1.2 MB',
							icon: 'fa-file-powerpoint text-warning',
							url: '/files/Project-Timeline.pptx'
						}
					]
				}
			};

			// Populate folder contents
			const currentFolder = folderContents[folderId] || folderContents['1'];
			const filesHtml = currentFolder.files.map(file => `
				<tr>
					<td data-order="${file.name}">
						<div class="d-flex align-items-center">
							<span class="icon-wrapper">
								<i class="fa-solid ${file.icon} fs-2x me-4"></i>
							</span>
							<a href="#" class="text-primary menu-link viewAttachment" data-url="${file.url}" style="text-decoration: none;">
								${file.name}
							</a>
						</div>
					</td>
					<td>${file.date}</td>
					<td>${file.type}</td>
					<td>${file.size}</td>
				</tr>
			`).join('');

			$('#folderContents').html(filesHtml);

			// Initialize menu
			KTMenu.init();

			// Event handlers
			$('#txtSearchInputField').on('keydown', function (e) {
				if (e.key === 'Enter' || e.keyCode === 13) {
					e.preventDefault();
					$('.btnSearch').click();
				}
			});

			$(document).on('click', '.btnReset', function (e) {
				e.preventDefault();
				$('#txtSearchInputField').val('');
				$('.btnSearch').click();
			});

			$(document).on('click', '.btnSearch', function (e) {
				e.preventDefault();
				alert("Search functionality will be implemented in dynamic version");
			});

			$(document).on("click", ".viewAttachment", function (e) {
				e.preventDefault();
				let fileUrl = $(this).data("url");
				console.log("fileUrl to: "+fileUrl);
				$("#hiddenFileUrl").val(fileUrl);
				let extension = fileUrl.substring(fileUrl.lastIndexOf('.')).toLowerCase();

				console.log("Extracted extension: " + extension);
				if(extension=='.xlsx'||extension=='.docx'){
					$("#kt_app_main").hide();
					$("#pdfViewerWrapperexcell").show();
				}
				else if (fileUrl && fileUrl.trim() !== "") {
					$("#kt_app_main").hide();
					$("#pdfViewer").attr("src", fileUrl);
					$("#pdfViewerWrapper").show();
				} else {
					alert("Attachment Not Found: The file URL is missing or invalid.");
				}
			});

			$(document).on("click", "#btnBack", function (e) {
				window.location.href = '@Url.Content("~/FileManager/Index")';
			});
		});
	</script>
</div>