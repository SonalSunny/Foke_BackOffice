@model IndexModel
@using FOKE.Localization
@using X.PagedList;
@using X.PagedList.Mvc.Core;
@using FOKE.Models.PageModels
@inject ISharedLocalizer Localize

<div class="table-responsive">
    <input type="hidden" asp-for="pageNo" id="hidpageNo" />
    <input type="hidden" asp-for="pageSize" id="hidpageSize" />
    <input type="hidden" asp-for="sortColumn" id="hidSortColumnMembers" />
    <input type="hidden" asp-for="sortOrder" id="hidSortOrderMembers" />

    <table class="table table-hover table-rounded table-striped border gy-4 gs-7 table-sortable table-scroll">
        <thead>
            <tr>
                <th class="sorting t-plr-sm-5">
                    @Localize.Localize("TABLE_ACTION_HEADER")
                </th>
                <th class="sorting t-plr-sm-5" area-field="Photo">
                    @Localize.Localize("PHOTO")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="Group">
                    @Localize.Localize("GROUP")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="Committee">
                    @Localize.Localize("COMMITTEE")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="Name">
                    @Localize.Localize("NAME")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="Position">
                    @Localize.Localize("POSITION")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="ContactNo">
                    @Localize.Localize("CONTACT")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
                <th class="sorting t-plr-sm-5" area-field="MemberOrder">
                    @Localize.Localize("MEMBER_ORDER")
                    <span><i class="fas fa-sort text-white" aria-hidden="true"></i></span>
                </th>
            </tr>
        </thead>
        <tbody>
               @if (Model.pagedListDataMembers != null && Model.pagedListDataMembers.Count() > 0)
            {
                @for (int i = 0; i < Model.pagedListDataMembers.Count(); i++)
                {
                    var item = Model.pagedListDataMembers[i];
          
                <tr>
                        <td>
                            <div class="test btn btn-icon btn-sm btn-light btn-center btn-active-light-primary"
                                 data-kt-menu-trigger="click"
                                 data-kt-menu-placement="bottom-end">
                            </div>

                            <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                                 data-kt-menu="true">
                                <div class="menu-item px-3">
                                    <a href="#"
                                       class="menu-link px-3 btnItemEditMember" keyID="@item.CommitteMemberId">@Localize.Localize("TABLE_BTN_TITLE_EDIT")</a>
                                </div>


                                @if (item.Active)
                                {
                                    <div class="menu-item px-3">
                                        <a href="#" class="text-muted menu-link px-3 btnItemDeleteMember" keyID="@item.CommitteMemberId" delete="1"
                                           title="@Localize.Localize("TABLE_BTN_TITLE_DEACTIVATE")" data-kt-customer-table-filter="delete_row">@Localize.Localize("TABLE_BTN_TITLE_DEACTIVATE")</a>
                                    </div>
                                }
                                else
                                {
                                    <div class="menu-item px-3">
                                        <a href="#" class="text-muted menu-link px-3 btnItemDeleteMember" keyID="@item.CommitteMemberId" delete="0"
                                           title="@Localize.Localize("TABLE_BTN_TITLE_ACTIVATE")" data-kt-customer-table-filter="delete_row">@Localize.Localize("TABLE_BTN_TITLE_ACTIVATE")</a>
                                    </div>
                                }
                                <div class="menu-item px-3">
                                    <a href="#"
                                       class="menu-link px-3 btnItemViewMember" keyID="@item.CommitteMemberId">@Localize.Localize("TABLE_BTN_TITLE_VIEW")</a>
                                </div>


                            </div>
                        </td>
                    <td>
                        @if (!string.IsNullOrEmpty(item.ImagePath))
                        {
                            <img src="@item.ImagePath" alt="Member Photo" class="img-thumbnail" style="width: 50px; height: 50px;" />
                        }
                        else
                        {
                            <span>No Photo</span>
                        }
                    </td>
                    <td>@item.GroupName</td>
                  <td>@item.CommitteeName</td>
                    <td>@item.Name</td>
                    <td>@item.Position</td>
                    <td>@item.AnyValue</td>
                    <td>@item.SortOrder</td>
                </tr>
            }
            }
        </tbody>
    </table>
</div>

<div class="row">
    <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start pt-3">
        <div class="dataTables_length" id="kt_datatable_fixed_header_length">
            <label>
                <select asp-for="pageSize" id="kt_datatable_page_size" class="form-select form-select-sm form-select-solid">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </label>
        </div>
        <div class="dataTables_info" id="kt_datatable_fixed_header_info" role="status" aria-live="polite">
            Showing @(Model?.pagedListDataMembers?.FirstItemOnPage ?? 0) to @(Model?.pagedListDataMembers?.LastItemOnPage ?? 0) of @(Model?.pagedListDataMembers?.TotalItemCount ?? 0) records
        </div>
    </div>
    <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
        <div class="dataTables_paginate paging_simple_numbers" id="kt_datatable_fixed_header_paginate">
            @if (Model.hasPagination)
            {
                <div>
                    @Html.PagedListPager((IPagedList)Model.pagedListDataMembers, page => Url.Page("Index", "PagedListMembers",
                             new
                             {
                                 pn = page,
                                 ps = Model.pageSize,
                                 so = Model.sortOrder,
                                 sc = Model.sortColumn,
                                 nm = Model.globalSearch
                             }),
                             PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new PagedListRenderOptions()
                {
                    PageClasses = new string[] { "page-link" },
                    LiElementClasses = new string[] { "page-item" },
                    UlElementClasses = new string[] { "pagination pagination-circle pagination-outline" },
                    EllipsesElementClass = "ki-duotone ki-double-left fs-2",
                    Display = PagedListDisplayMode.IfNeeded,
                    DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                    DisplayLinkToLastPage = PagedListDisplayMode.Always,
                    DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                    DisplayLinkToNextPage = PagedListDisplayMode.Always,
                    LinkToPreviousPageFormat = "<i class='fas fa-angle-left'></i>",
                    LinkToNextPageFormat = "<i class='fas fa-angle-right'></i>",
                    LinkToFirstPageFormat = "<i class='fas fa-step-backward'></i>",
                    LinkToLastPageFormat = "<i class='fas fa-step-forward'></i>",
                    MaximumPageNumbersToDisplay = 10, // Adjust this number as needed
                }, new AjaxOptions()
                { HttpMethod = "Get", UpdateTargetId = "memberListContainer", OnBegin = "showInTableLoader()", OnSuccess = "", OnComplete = "hideInTableLoader()" }))
                </div>
            }
        </div>
    </div>
</div>

<div id="tableLoader" class="loader-container">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<script src="~/js/ktable.js" asp-append-version="true"></script>
<script type="text/javascript">
    $(function () {
        KTMenu.init()
        $(document).ready(function () {
            $("#tableLoader").removeClass("hidden");
            $(document).ready(function () {
                $("#tableLoader").addClass("hidden");
            });
        });

        $('.btnItemDeleteMember').click(function () {
            var keyID = $(this).attr('keyID')
            var ID = $(this).attr('delete')
            var url = $("#hidMemberDeletePageUrl").val();

            if (ID == 1) {
                Swal.fire({
                    title: 'Are you sure?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, Deactivate it!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        var data = { keyid: keyID, Id: ID }
                        postAjaxDeleteMasterData($("#hidMemberDeletePageUrl").val(), data, function (e) {
                            $("#btnRefresh").trigger("click")
                        });
                    }
                })
            }
            else {
                Swal.fire({
                    title: 'Are you sure?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, Activate it!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        var data = { keyid: keyID, Id: ID }
                        postAjaxDeleteMasterData($("#hidMemberDeletePageUrl").val(), data, function (e) {
                            $("#btnRefresh").trigger("click")
                        });
                    }
                })
            }
            return false;
        });

        $('.btnItemEditMember').click(function () {
            var modID = $(this).attr('keyID')
            var url = $("#hidMemberManagePageUrl").val() + "?id=" + modID + "&mode=edit"
            top.showPopup("Update Member", url, 800, 450, window.frameElement.id);
           
            return false;
        });
        
             $('.btnItemViewMember').click(function () {
        var groupId = $(this).attr('keyID');
        var url = "/CommitteManagement/ViewCommitteMember?id=" + groupId;
        top.showPopup("View Member", url, 600, 400, window.frameElement?.id);
        return false;
    });



    });
</script>
