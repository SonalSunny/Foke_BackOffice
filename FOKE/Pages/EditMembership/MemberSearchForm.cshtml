@page
@using FOKE.Localization
@model FOKE.Pages.EditMembership.MemberSearchFormModel
@inject ISharedLocalizer Localize



<link href="~/css/searchform.css" rel="stylesheet" />

<div class="search-container">
    <div class="search-card">
        <div class="search-title">@Localize.Localize("Search Member")</div>
        <div class="form-inline">
            <select asp-for="inputModel.SearchText" class="form-select form-select-sm"
                    asp-items='@new SelectList(Model.pageListFilterColumns, "ColumName", "ColumnDescription")'>
            </select>

            <input type="text" class="form-control form-control-sm" placeholder="@Localize.Localize("Enter search keyword")" id="txtSearchInputField" />

            <button type="button" class="btn btn-sm btn-primary" id="btnRefresh">
                <i class="fas fa-search"></i> @Localize.Localize("BTN_SEARCH")
            </button>
 </div>

        <div id="resultsContainer" class="mt-5">
            <!-- Static results example -->
          </div>
    </div>
</div>

<script>
       document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('btnRefresh').addEventListener('click', function () {
            const keyword = document.getElementById('txtSearchInputField').value.trim();
         
            const selectedColumn = document.querySelector('[name="inputModel.SearchText"]').value;

            if (keyword === "") {
                alert("Please enter a keyword to search.");
                return;
            }

            $.ajax({
                  // url: '@Url.Page("MemberSearchForm", new { handler = "GetDetails" })',
                url: '@Url.Page("MemberSearchForm", "GetDetails")',
                type: 'GET',
                data: {
                    keyword: keyword,
                    searchText: selectedColumn
                },
                success: function (response) {
                    if (response && response.returnData && response.returnData.length > 0) {
                        const members = response.returnData;
                        console.log(members);
                        let table = `
                            <table class="table table-bordered table-striped mt-3">
                                <thead class="table-light">
                                    <tr>
                                        <th>Photo</th>
                                        <th>Membership ID</th>
                                        <th>Full Name</th>
                                        <th>Profession</th>
                                        <th>Workplace</th>
                                        <th>Department</th>
                                        <th>Area</th>
                                        <th>Unit</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;

                        members.forEach(member => {
                            table += `
                                <tr>
                                    <td><img src="${member.profileImagePath || '/images/Default.jpg'}"alt="Profile" style="width:50px;height:50px;border-radius:50%;object-fit:cover;" /> </td>
                                    <td>${member.referenceNumber || ''}</td>
                                    <td><a href="/EditMembership/Manage?id=${member.issueId}">${member.name}</a></td>
                                    <td>${member.profession || ''}</td>
                                    <td>${member.workPlace || ''}</td>
                                    <td>${member.departmentName || ''}</td>
                                    <td>${member.area || ''}</td>
                                    <td>${member.unit || ''}</td>
                                </tr>
                            `;
                        });

                        table += `</tbody></table>`;
                         document.getElementById('resultsContainer').innerHTML = `
                            <div class="table-responsive">
                                ${table}
                            </div>
                        `;

                    } else {
                        document.getElementById('resultsContainer').innerHTML = `<p class="text-danger mt-3">No results found.</p>`;
                    }
                },
                error: function () {
                    alert("An error occurred while fetching the member data.");
                }
            });
        });
    });
</script>