@page
@using FOKE.Localization
@model FOKE.Pages.MembersList.MembersByZone.IndexModel
@{
}
@inject ISharedLocalizer Localize
@Html.AntiForgeryToken()

<input type="hidden" id="hidManagePageUrl" value="@Url.Content("~/MembersByZone/Manage")" />
<input type="hidden" id="hidPaymentPageUrl" value="@Url.Content("~/PayMembershipFee/PayFee")" />
<input type="hidden" id="SavePaymentPageUrl" value="@Url.Page("/MembersList/MembersByZone/Index", "SaveRemark")" />
<div class="card mb-5 mb-xl-10 pb-5">
    <div class="card-header cursor-pointer border-bottom" role="button">
        <div class="card-title m-0">
            <h3 class="fw-bold m-0">
                @Localize.Localize("MENU_MEMBERS_BY_ZONE")
            </h3>
        </div>
        <div class="d-flex align-items-center gap-2 gap-lg-3">
            <div class="m-0">
            </div>
        </div>
    </div>
    <div class="card-body mx-5 px-0" style="padding: 0 10px !important;">
        <div class="table-header d-flex align-items-center justify-content-between">
            <div class="card-title gap-md-2 d-md-flex">
                <div class="d-flex align-items-center position-relative my-1 w-100 w-md-200px">
                    <select asp-for="Zoneid"
                            class="form-select form-select-solid form-select-sm" data-control="select2" data-hide-search="true"
                            asp-items='@new SelectList(Model.ZoneList, "keyID", "name")'>
                        <option value="">Select</option>
                    </select>
                  @*   <select id="zoneFilterDropdown" class="form-select form-select-solid form-select-sm"
                            data-control="select2" data-hide-search="true">
                        <option value="Zone 1" selected><strong>Zone 1</strong></option>
                        <option value="Zone 2"><strong>Zone 2</strong></option>
                        <option value="Zone 3"><strong>Zone 3</strong></option>
                    </select> *@
                </div>
            </div>
            <div class="btn-group btn-group-sm" role="group" aria-label="Payment Status">
                <input type="radio" class="btn-check" name="paymentStatus" id="radioUnpaid" value="Unpaid" autocomplete="off" checked>
                <label class="btn btn-outline-primary" for="radioUnpaid">@Localize.Localize("Unpaid")</label>

                <input type="radio" class="btn-check" name="paymentStatus" id="radioPaid" value="Paid" autocomplete="off">
                <label class="btn btn-outline-primary" for="radioPaid">@Localize.Localize("Paid")</label>

                <input type="radio" class="btn-check" name="paymentStatus" id="radioAll" value="All" autocomplete="off">
                <label class="btn btn-outline-primary" for="radioAll">@Localize.Localize("DD_ALL_TABLE_SEARCH")</label>
            </div>


        </div>
        <div class="collapse mb-5" id="kt_advanced_search_form">
            <div class="separator separator-dashed mt-2 mb-3"></div>
            <div class="card-rounded bg-light p-5">
                <form method="post" data-ajax="true" asp-page-handler="ApplyFilter" data-ajax-method="post" data-ajax-begin="showPageLoader()"
                      data-ajax-success='$("#btnRefresh").trigger("click")' id="transalationsForm" novalidate="novalidate" autocomplete="off">
                    <button type="button" id="btnRefresh" style="display: none;"></button>
                    <input type="hidden" name="Zoneid" id="HiddenZoneid" value="@Model.Zoneid" />
              @*   <form method="post" id="transalationsForm" novalidate="novalidate" autocomplete="off"> *@
                    <div class="row g-8">
                        <div class="table-header d-flex align-items-center">
                            <div class="card-title">
                                <h3 class="text-dark m1-7 fw-normal">@Localize.Localize("TABLE_ADVANCE_FILTER_TITLE")</h3>
                            </div>
                            <div class="card-toolbar">
                                <button type="submit" class="badge badge-primary b-border" data-kt-menu-dismiss="true">Apply</button>
                            </div>
                        </div>
                        <div class="separator separator-dashed mb-1 mt-1"></div>
                        <div class="col-lg-3 filter-margin">
                            <label class="fs-6 mb-2">@Localize.Localize("Profession")</label>
                            <select asp-for="ProffessionID"
                                    class="form-select form-select-sm select2"
                                    asp-items='@new SelectList(Model.ProffessionList, "keyID", "name")'>
                                <option value="">Select</option>
                            </select>
                           @*  <select class="form-select form-select-sm select2">
                                <option value="">Select Filter</option>
                            </select> *@
                        </div>
                        <div class="col-lg-3 filter-margin">
                            <label class="fs-6 mb-2">@Localize.Localize("Work Place")</label>
                            <select asp-for="WorkPlaceId"
                                    class="form-select form-select-sm select2"
                                    asp-items='@new SelectList(Model.WorkPlaceList, "keyID", "name")'>
                                <option value="">Select</option>
                            </select>
                            @*  <select class="form-select form-select-sm select2">
                                <option value="">Select Filter</option>
                            </select> *@
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="_postList" class="grid-position">
            <partial name="_IndexPartial" model="Model" />
        </div>
    </div>
</div>

@section scripts {
<script src="~/js/kTable.js" asp-append-version="true"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // Initialize select2 without search
        $('#Zoneid').select2({
            minimumResultsForSearch: Infinity
        });
            $('input[name="paymentStatus"]').change(function () {
                var selectedValue = $('input[name="paymentStatus"]:checked').val();
                var zoneid= $('#HiddenZoneid').val();
                console.log("Selected:", selectedValue);
                $.ajax({
                        url: "/MembersList/MembersByZone/Index?handler=PagedList",
                        method: "GET",
                        data: {
                            Value: selectedValue,
                            searchfield:zoneid
                        },
                        success: function (result) {
                            $("#_postList").html(result);
                        },

                    });
            });


          $("#_postList").kTable({
            submitButton: '#btnRefresh',
            resetButton: '#btnReset',
            targetContainer: '_postList',
            searchInputField: '#txtSearchInputField',
            searchColumnChooser: '#globalSearchColumnChooser',
            resourceUrl: "@Url.Page("Index", "PagedList")",
            pageSize: "@Model.pageSize",
            loadOnPageLoad: true,
            sOrderField: "#hidSortOrder",
            sOrderColumnField: "#hidSortColumn",
            exportUrl: "@Url.Page("Index", "ExportData")",
            exportButton: '#btnExport',
            radiobutton: '#hidRadio' ,// ✅ fixed here
            searchfield:'#hidSearchfield'
        });

        });

        $(function () {
              // On area dropdown change
              $('#Zoneid').change(function () {
                  var selectedArea = $(this).val();
                       var paymentStatus = $('input[name="paymentStatus"]:checked').val();
                  $('#HiddenZoneid').val(selectedArea); // keep it in hidden field

                  $.ajax({
                      url: "/MembersList/MembersByZone/Index?handler=PagedList",
                      method: "GET",
                      data: {
                              searchfield: selectedArea,
                              Value: paymentStatus,
                      },
                      beforeSend: function () {
                          $("#tableLoader").removeClass("hidden");
                      },
                      success: function (result) {
                          $("#_postList").html(result);
                      },
                      complete: function () {
                          $("#tableLoader").addClass("hidden");
                      }
                  });
              });
                  var storedRadio = $('#hidRadio').val();
            var search = $('#hidSearchfield').val();

            // ✅ Apply stored values to the UI
            if (storedRadio) {
                $("input[name='paymentStatus'][value='" + storedRadio + "']").prop("checked", true);
            }

            if (search) {
                    $('#Zoneid').val(search).trigger('change.select2'); // for select2
                // $('#hidUnitId').val(search);
                    $('#HiddenZoneid').val(search);
            }

            // ✅ Now trigger the AJAX load once both are set
            if (storedRadio || search) {
                var paymentStatus = $('input[name="paymentStatus"]:checked').val();
                    var selectedArea = $('#Zoneid').val();

                $.ajax({
                    url: "/MembersList/MembersByZone/Index?handler=PagedList",
                    method: "GET",
                    data: {
                        Value: paymentStatus,
                        searchfield: selectedArea
                    },
                    beforeSend: function () {
                        $("#tableLoader").removeClass("hidden");
                    },
                    success: function (result) {
                        $("#_postList").html(result);
                    },
                    complete: function () {
                        $("#tableLoader").addClass("hidden");
                    }
                });
            }

          });

    </script>
}





     
      


