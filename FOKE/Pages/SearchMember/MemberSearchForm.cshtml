@page
@using FOKE.Localization
@model FOKE.Pages.SearchMember.MemberSearchFormModel
@{
}
@inject ISharedLocalizer Localize
@Html.AntiForgeryToken()


<style>
    .search-container {
        display: flex;
        justify-content: center;
        align-items: flex-start; /* align towards top */
        padding-top: 80px; /* push it down slightly */
        height: calc(100vh - 80px); /* keeps original height logic */
        background-color: #f9fbfd;
    }

    .search-card {
        background: white;
        padding: 2rem 3rem;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 700px;
        text-align: center;
    }

    .search-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #2d3748;
    }

    .form-inline {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

        .form-inline select,
        .form-inline input {
            flex: 1;
            min-width: 150px;
        }

        .form-inline button {
            white-space: nowrap;
        }
</style>

<div class="search-container">
    <div class="search-card">
        <div class="search-title">@Localize.Localize("Search Member")</div>
        <div class="form-inline">
            <select asp-for="inputModel.SearchText" class="form-select form-select-sm"
                    asp-items='@new SelectList(Model.pageListFilterColumns, "ColumName", "ColumnDescription")'>
            </select>

            <input type="text" class="form-control form-control-sm" placeholder="@Localize.Localize("Enter search keyword")" id="txtSearchInputField" />

            <button type="button" class="btn btn-sm btn-primary" id="btnRefresh">
                <i class="fas fa-search"></i>@Localize.Localize("BTN_SEARCH")
            </button>
        </div>

        <div id="resultsContainer" class="mt-5">
            <!-- Results will be populated here -->
        </div>



    </div>

   

</div>
    <script>
           document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('btnRefresh').addEventListener('click', function () {
            const keyword = document.getElementById('txtSearchInputField').value.trim();
            const selectedColumn = document.querySelector('[name="inputModel.SearchText"]').value;

            if (keyword === "") {
                alert("Please enter a keyword to search.");
                return;
            }

            $.ajax({
                url: '@Url.Page("MemberSearchForm", "GetDetails")',
                type: 'GET',
                data: {
                    keyword: keyword,
                    searchText: selectedColumn
                },
                success: function (response) {
                    if (response && response.returnData && response.returnData.length > 0) {
                        const members = response.returnData;
                        console.log(members);
                        let table = `
                            <table class="table table-bordered table-striped mt-3">
                                <thead class="table-light">
                                    <tr>
                                     <th>Photo</th>
                                        <th>Membership ID</th>
                                        <th>Full Name</th>
                                        <th>Profession</th>
                                        <th>Workplace</th>
                                        <th>Department</th>
                                        <th>Area</th>
                                        <th>Unit</th>

                                    </tr>
                                </thead>
                                <tbody>
                        `;

                        members.forEach(member => {
                            table += `
                                <tr>
                                    <td> <img src="${member.profileImagePath || '/images/Default.jpg'}" alt="Profile"  style="width:50px;height:50px;border-radius:50%;object-fit:cover;" /> </td>                                   
                                    <td>${member.referenceNumber || ''}</td>                                
                                    <td><a href="/AllMembersList/MemberDetailsView?id=${member.issueId}">${member.name}</a></td>
                                    <td>${member.profession || ''}</td>
                                    <td>${member.workPlace || ''}</td>
                                    <td>${member.departmentName || ''}</td>
                                    <td>${member.area || ''}</td>
                                    <td>${member.unit || ''}</td>
                                </tr>
                            `;
                        });

                        table += `</tbody></table>`;
                        document.getElementById('resultsContainer').innerHTML = table;
                    } else {
                        document.getElementById('resultsContainer').innerHTML = `<p class="text-danger mt-3">No results found.</p>`;
                    }
                },
                error: function () {
                    alert("An error occurred while fetching the member data.");
                }
            });
        });
    });

</script>


