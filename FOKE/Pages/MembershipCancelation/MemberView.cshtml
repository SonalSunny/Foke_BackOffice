	@page
	@model MemberViewModel
	@inject ISharedLocalizer Localize
	@using FOKE.Localization
	@using FOKE.Models.PageModels
	@{
	}
	<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

	<div id="kt_app_content" class="app-content flex-column-fluid">
		<div id="kt_app_content_container" class="app-container container-xxl">
			<div class="card">
				<div class="container mt-4"> <!-- This adds spacing similar to the second section -->
				<div class="card shadow-lg rounded overflow-hidden mb-5">
					<!-- Task Header with Gradient Background -->
					<div class="p-4 text-white fw-bold fs-3" style="background: linear-gradient(to right, #4da0f3, #007bff);">
						🧑‍💼 @* @Localize.Localize("TASK_NUMBER") : @Model.inputModel.TaskNumber *@ @Localize.Localize("Membership Details")
					</div>

					<!-- Task Content (Unchanged, but now with shadow) -->
					<div class="card-body shadow-sm p-4">

						<div class="card shadow-sm p-4 mb-4">

							<h5 class="card-title mb-3">
								👤 Personal Information
							</h5>

							<div class="row g-4 mb-0 p-1">
								<div class="col-4 p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Name") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.Name
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Civil ID") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.CivilId
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Passport No") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.PassportNo
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Date of Birth") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.DateofBirthString
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Gender") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.Gender
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Contact Number") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">@Model.inputModel.ContactNo</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("WhatsApp Number") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">@Model.inputModel.WhatsappNoString</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Email") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">@Model.inputModel.Email</div>
									</div>
								</div>


								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Blood Group") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.BloodGroup
										</div>
									</div>
								</div>
								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Profession") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.Profession
										</div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Area") :
										</div>
										<div class="fw-bold fs-6 text-gray-800"> @Model.inputModel.Area </div>
									</div>
								</div>

								<div class="col-4  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Company") :
										</div>
										<div class="fw-bold fs-6 text-gray-800"> @Model.inputModel.Company </div>
									</div>
								</div>

								<div class="col-12  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Kuwait Address") :
										</div>
										<div class="fw-bold fs-6 text-gray-800"> @Model.inputModel.KuwaitAddress </div>
									</div>
								</div>
							</div>
						</div>


						<div class="card shadow-sm p-4 mb-4">

							<h5 class="card-title mb-3">
								🏠 Kerala Details
							</h5>

							<div class="row g-4 mb-0 p-1">
								<div class="col-12  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Permenant Address") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.PermenantAddress
										</div>
									</div>
								</div>
								<div class="col-12 p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Pincode") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.Pincode
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="card shadow-sm p-4 mb-4">

							<h5 class="card-title mb-3">
								⚠️ Emergency Contact Details
							</h5>

							<div class="row g-4 mb-0 p-1">
								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Name") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.EmergencyContactName
										</div>
									</div>
								</div>
								<div class="col-6 p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Relation") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.EmergencyContactRelationString
										</div>
									</div>
								</div>
								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Contact No") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.EmergencyContactNumberString
										</div>
									</div>
								</div>
								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Email") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.EmergencyContactEmail
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="card shadow-sm p-4 mb-4">

							<h5 class="card-title mb-3">
								👤 Campaign Details
							</h5>

							<div class="row g-4 mb-0 p-1">

								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Campaign") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">@Model.inputModel.CampaignName</div>
									</div>
								</div>

								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Campaign Amount") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.CampaignAmount
										</div>
									</div>
								</div>

								<div class="col-6 p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Received Amount") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.AmountRecieved
										</div>
									</div>
								</div>

								<div class="col-6  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Payment Type") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">
											@Model.inputModel.PaymentType

										</div>
									</div>
								</div>

								<div class="col-12  p-3">
									<div class="col-sm-6">
										<div class="fw-semibold fs-7 text-gray-600 mb-1">
											@Localize.Localize("Payment Remarks") :
										</div>
										<div class="fw-bold fs-6 text-gray-800">@Model.inputModel.PaymentRemarks </div>
									</div>
								</div>
							</div>
						</div>
						
						<div class="col-12 d-flex justify-content-end">
							<div class="d-flex flex-stack p-2">
								<button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#cancelModal">
									<i class="fas fa-user-times"></i> Cancel Membership
								</button>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>


						
						
						

							
						

						
					


<!-- Modal Layout -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<!-- Centered vertically -->
		<div class="modal-content shadow rounded-4">
			<div class="modal-header bg-danger" text-white border-bottom-0 rounded-top">
				<h3 class="modal-title text-white fw-bold" id="cancelModalLabel">Cancel Membership</h3>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>

			<div class="modal-body">
				<form id="cancelForm">
					@Html.AntiForgeryToken()

					<div class="mb-3">
						<label for="cancelReason" class="form-label">Cancellation Reason</label>
						<select asp-for="inputModel.RejectionReasonId" id="cancelReason" class="form-select form-select-sm"
								class="form-select form-select-sm select2"
								asp-items='@new SelectList(Model.RejectedReasonList, "keyID", "name")'>
							<option value="">Select</option>
						</select>
					
					</div>
					<div class="mb-3">
						<label for="cancelDesc" class="form-label">Cancellation Remark</label>
						<textarea class="form-control" id="cancelDesc" rows="3" placeholder="Enter more details..."></textarea>
					</div>
				</form>
			</div>

			<div class="modal-footer border-top-0">
				<button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn btn-danger" onclick="submitCancellation()">Submit</button>
			</div>
		</div>
	</div>
</div>

<!-- Add SweetAlert2 CDN -->
<script>
	function submitCancellation() {
		const reason = document.getElementById('cancelReason').value;
		const desc = document.getElementById('cancelDesc').value;

		if (!reason) {
			alert("Please select a cancellation reason.");
			return;
		}
		   const memberId = '@Model.inputModel.IssueId';
		// Post to backend
		fetch('/MembershipCancelation/MemberView?handler=CancelMember',  {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'XSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]').value
			},
			body: JSON.stringify({    memberId: memberId,
			reason: reason,
			description: desc  })
		})
		.then(res => {
			if (res.ok) {
				// Close modal and notify
				const modal = bootstrap.Modal.getInstance(document.getElementById('cancelModal'));
				modal.hide();

				Swal.fire('Cancelled', 'The member has been cancelled.', 'success').then(() => {
					// Redirect after the alert is closed
					window.location.href = '/MembershipCancelation/MemberSearchForm';
					// Change to your actual search page route
				});
			} else {
				throw new Error("Failed to cancel");
			}
		})
		.catch(err => {
			Swal.fire('Error', err.message, 'error');
		});
	}
</script>


							

						